import{j as i,k as $,l as j,o as l,c as r,a as t,t as u,b as v,m as B,T as D,w as k,_ as y,f as N,v as S,F as T,d as U,e as w,i as V}from"./VueFeather-Bf5e6Pfw.js";const E=["name","value"],F={key:0,class:"absolute top-full left-0 w-full bg-white mt-1 rounded shadow"},L=["placeholder"],A={class:"overflow-auto max-h-48"},M=["onClick"],O={class:"mr-2"},q={key:0,class:"p-2 text-center"},z={__name:"ForeignSelection",props:["type","field","default","column_name","api_endpoint","referenced_table_name","referenced_column_name"],setup(d){const s=d,c=i(!1),m=i(s.default),o=i(""),_=i(null),p=$([]),b={credentials:"same-origin",headers:{Accept:"application/json"}},g=a=>{const e=[];for(const n of Object.keys(a))e.push(`${n}=${a[n]}`);return encodeURI(e.join("&"))},f=()=>{const a={search:o.value,referenced_table_name:s.referenced_table_name,referenced_column_name:s.referenced_column_name};fetch(`${s.api_endpoint}?${g(a)}`,b).then(e=>e.json()).then(e=>p.values=e)},C=()=>{c.value=!0,setTimeout(()=>_.value.focus())};f();const x=a=>{m.value=a.key,o.value="",c.value=!1},h=()=>{c.value=!1,o.value=""};return document.addEventListener("click",h),j(()=>document.removeEventListener("click",h)),(a,e)=>(l(),r("div",{class:"relative",onClick:e[1]||(e[1]=k(()=>{},["stop"]))},[t("input",{type:"hidden",name:d.field,value:m.value},null,8,E),t("div",{class:"input flex justify-between items-center cursor-default",onClick:C},[t("div",null,u(m.value||"Selection"),1),v(y,{type:"chevron-down",size:"16",strokeWidth:"3"})]),v(D,{name:"fade"},{default:B(()=>[c.value?(l(),r("div",F,[t("form",{class:"p-1 search",onSubmit:k(f,["prevent"])},[N(t("input",{ref_key:"search_elem",ref:_,type:"text",class:"input w-full","onUpdate:modelValue":e[0]||(e[0]=n=>o.value=n),placeholder:`search ${d.referenced_table_name}...`},null,8,L),[[S,o.value]]),t("div",{class:"icon",onClick:f},[v(y,{type:"search"})])],32),t("div",A,[(l(!0),r(T,null,U(p.values,n=>(l(),r("div",{class:"p-2 hover:bg-gray-200 transition cursor-pointer",onClick:I=>x(n)},[t("span",O,u(s.referenced_column_name.toUpperCase())+": "+u(n.key),1),t("span",null,u(n.string),1)],8,M))),256)),p.values.length===0?(l(),r("div",q," No results found. ")):w("",!0)])])):w("",!0)]),_:1})]))}};V({components:{"foreign-selection":z}}).mount("#app");
