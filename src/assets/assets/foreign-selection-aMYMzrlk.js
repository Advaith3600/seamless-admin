import{r as u,a8 as B,a9 as $,B as r,y as n,a0 as d,p as _,g as j,aa as D,D as k,ab as N,o as c,ac as S,ad as U,a3 as V,a4 as E,Z as g,c as L,a as T}from"./common-components-a90jO93J.js";const A=["name","value"],F={key:0,class:"absolute top-full left-0 w-full bg-white mt-1 rounded shadow"},M=["placeholder"],O={class:"overflow-auto max-h-48"},q=["onClick"],z={class:"mr-2"},I={key:0,class:"p-2 text-center"},R={__name:"ForeignSelection",props:["type","field","default","column_name","api_endpoint","referenced_table_name","referenced_column_name"],setup(p){const a=p,i=u(!1),m=u(a.default),s=u(""),h=u(null),f=B([]),w={credentials:"same-origin",headers:{Accept:"application/json"}},C=t=>{const e=[];for(const o of Object.keys(t))e.push(`${o}=${t[o]}`);return encodeURI(e.join("&"))},v=()=>{const t={search:s.value,referenced_table_name:a.referenced_table_name,referenced_column_name:a.referenced_column_name};fetch(`${a.api_endpoint}?${C(t)}`,w).then(e=>e.json()).then(e=>f.values=e)},b=()=>{i.value=!0,setTimeout(()=>h.value.focus())};v();const x=t=>{m.value=t.key,s.value="",i.value=!1},y=()=>{i.value=!1,s.value=""};return document.addEventListener("click",y),$(()=>document.removeEventListener("click",y)),(t,e)=>{const o=N("vue-feather");return c(),r("div",{class:"relative",onClick:e[1]||(e[1]=k(()=>{},["stop"]))},[n("input",{type:"hidden",name:p.field,value:m.value},null,8,A),n("div",{class:"input flex justify-between items-center cursor-default",onClick:b},[n("div",null,d(m.value||"Selection"),1),_(o,{type:"chevron-down",size:"16",strokeWidth:"3"})]),_(D,{name:"fade"},{default:j(()=>[i.value?(c(),r("div",F,[n("form",{class:"p-1 search",onSubmit:k(v,["prevent"])},[S(n("input",{ref_key:"search_elem",ref:h,type:"text",class:"input w-full","onUpdate:modelValue":e[0]||(e[0]=l=>s.value=l),placeholder:`search ${p.referenced_table_name}...`},null,8,M),[[U,s.value]]),n("div",{class:"icon",onClick:v},[_(o,{type:"search"})])],32),n("div",O,[(c(!0),r(V,null,E(f.values,l=>(c(),r("div",{class:"p-2 hover:bg-gray-200 transition cursor-pointer",onClick:W=>x(l)},[n("span",z,d(a.referenced_column_name.toUpperCase())+": "+d(l.key),1),n("span",null,d(l.string),1)],8,q))),256)),f.values.length===0?(c(),r("div",I," No results found. ")):g("",!0)])])):g("",!0)]),_:1})])}}};L({components:{"foreign-selection":R,...T}}).mount("#app");
